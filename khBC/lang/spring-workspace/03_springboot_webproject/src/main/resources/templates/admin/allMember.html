<!DOCTYPE html>
<html xmlns:th = "http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style>
	input[type=checkbox].chk+label{
		height:24px;
	}
</style>
</head>
<body>
	<th:block th:include = "common/header"></th:block>
	<main class = "content">
		<section class = "section">
			<div class = "page-title">회원 관리 페이지</div>
			<table class = "tbl tbl-hover">
				<tr>
					<th style = "width:5%;">선택</th>
					<th style = "width:7%;">번호</th>
					<th style = "width:10%;">아이디</th>
					<th style = "width:10%;">이름</th>
					<th style = "width:15%;">전화번호</th>
					<th style = "width:20%;">주소</th>
					<th style = "width:13%;">가입일</th>
					<th style = "width:10%;">회원등급</th>
					<th style = "width:10%;">등급변경</th>
				</tr>
				<tr th:each = "m,status : ${list}">
					<td>
						<div class = "input-wrap">
							<input type = "checkbox" class = "chk" th:id = "${'chk'+ status.count}" >
							<label th:for = "${'chk'+status.count}"></label>
						</div>
					</td>
					<td th:text = "${m.memberNo}"></td>
					<td th:text = "${m.memberId}"></td>
					<td th:text = "${m.memberName}"></td>
					<td th:text = "${m.memberPhone}"></td>
					<td th:text = "${m.memberAddr}"></td>
					<td th:text = "${m.enrollDate}"></td>
					<td>
						<div class = "select" th:switch = "${m.userLevel}">
							<select th:case = "1">
								<option value ="1" selected>관리자</option>
								<option value ="2" >정회원</option>
								<option value ="3">준회원</option>
							</select>
							<select th:case = "2">
								<option value ="1">관리자</option>
								<option value ="2" selected >정회원</option>
								<option value ="3">준회원</option>
							</select>
							<select th:case = "3">
								<option value ="1">관리자</option>
								<option value ="2" >정회원</option>
								<option value ="3" selected>준회원</option>
							</select>
						</div>
					</td>
					<td>
						<button class = "btn-primary changeLevel">등급변경</button>
					</td>
				</tr>
				<tr>
					<td colspan = "9">
					<button style = "width:100%" class = 'btn-point checkedChangeLevel'>선택회원 등급변경</button>
					</td>
				</tr>
			</table>
		</section>
	</main>
	
	<script>
		$(".changeLevel").on("click",function(){
			//클릭한 버튼을 기준으로 해당 행의 회원번호 가져옴
			const memberNo = $(this).parent().parent().children().eq(1).text();
			//클릭한 버튼을 기준으로 해당 행의 선택된 등급을 가져옴
			const userLevel = $(this).parent().prev().children().children().val();
			
			location.href = "/admin/changeLevel?memberNo="+memberNo+"&userLevel="+userLevel;
		});

		$(".checkedChangeLevel").on("click",function(){
			//체크된 체크박스만 선택해서 가져옴
			const checkbox = $(".chk:checked");
			if(checkbox.length === 0) {
				// 아무것도 체크 안하고 버튼 누른 경우
				return;
			}
			//체크된 회원번호를 저장할 배열
			const no = new Array();
			//체크된 회원 등급을 저장할 배열
			const level = new Array();
			
			//각 체크박스 기준으로 회원 번호와 회원 등급을 읽어와 배열에 저장
			checkbox.each(function(index,item){
				const memberNo = $(item).parent().parent().next().text();
				no.push(memberNo);
				const userLevel = $(item).parent().parent().parent().find("select").val();
				level.push(userLevel);
				//화면에서 컨트롤럴 데이터를 전송할 때
				//배열에 있는 모든 데이터를 특정 구분자 기준으로 합쳐서 하나의 문자열로 리턴해주는 함수 -> join ("/")
			});
				location.href = "/admin/checkedChangeLevel?no="+no.join("/")+"&level="+level.join("/");
			
		});
	</script>
	<th:block th:include = "common/footer"></th:block>
</body>
</html>